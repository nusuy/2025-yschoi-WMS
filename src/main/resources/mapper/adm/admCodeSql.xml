<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AdmCode">
	<!-- 공통코드 헤더 리스트 조회 -->
	<select id="ADM_CODE_SELECT_HEADER_LIST" resultType="java.util.HashMap">
		SELECT CODE_ID
			 , DESCR
			 , USE_YN
			 , TO_CHAR(INS_DT, 'YYYY-MM-DD HH24:mm:ss') AS INS_DT
			 , INS_ID
			 , INS_IP
			 , TO_CHAR(UPD_DT, 'YYYY-MM-DD HH24:mm:ss') AS UPD_DT
			 , UPD_ID
			 , UPD_IP
		FROM ADM_CODE
		WHERE SYSTEM_YN = 'N'
		ORDER BY CODE_ID ASC
	</select>
	
	<!-- 공통코드 디테일 조회 -->
	<select id="ADM_CODE_SELECT_DETAIL" resultType="java.util.HashMap">
		SELECT CODE_ID
			 , SEQ
			 , CODE_VALUE
			 , DESCR
			 , USE_YN
			 , TO_CHAR(INS_DT, 'YYYY-MM-DD HH24:mm:ss') AS INS_DT
			 , INS_ID
			 , INS_IP
			 , TO_CHAR(UPD_DT, 'YYYY-MM-DD HH24:mm:ss') AS UPD_DT
			 , UPD_ID
			 , UPD_IP
		FROM ADM_CODE_D
		WHERE CODE_ID = #{CODE_ID}
		ORDER BY USE_YN, SEQ ASC
	</select>
	
	<!-- 공통코드 ID 중복검사 -->
	<select id="ADM_CODE_CHK_ID" resultType="int">
		SELECT COUNT(*)
		FROM ADM_CODE
		WHERE CODE_ID = #{CODE_ID}
	</select>
	
	<!-- 공통코드 헤더 등록 -->
	<insert id="ADM_CODE_INSERT_NEW_HEDAER">
		INSERT
			INTO ADM_CODE (
				CODE_ID
			  , DESCR
			  , SYSTEM_YN
			  , USE_YN
			  , INS_DT
			  , INS_ID
			  , INS_IP
			) VALUES (
				#{CODE_ID}
			  , #{DESCR}
			  , #{SYSTEM_YN}
			  , #{USE_YN}
			  , SYSDATE
			  , #{USER_ID}
			  , #{USER_IP})
	</insert>
	
	<!-- 공통코드 디테일 등록 -->
	<insert id="ADM_CODE_INSERT_DETAIL">
			INSERT
				INTO ADM_CODE_D (
					CODE_ID
				  , SEQ
				  , CODE_VALUE
				  , DESCR
				  , USE_YN
				  , INS_DT
				  , INS_ID
				  , INS_IP
				) VALUES (
					#{CODE_ID}
				  , (SELECT NVL((SELECT T1.SEQ + 1
								  FROM (SELECT SEQ
								          FROM ADM_CODE_D
								         WHERE CODE_ID = #{CODE_ID}
								         ORDER BY SEQ DESC) T1
								 WHERE ROWNUM = 1), 1)
					   FROM DUAL)
				  , #{CODE_VALUE}
				  , #{DESCR}
				  , #{USE_YN}
				  , SYSDATE
				  , #{USER_ID}
				  , #{USER_IP})
	</insert>
</mapper>